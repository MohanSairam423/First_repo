def artifactname = "sp-boot-app"
def repoName = "sp-boot-app-repo"
def pkgName = "sp-boot-package"
pipeline {
  agent any
  //tools {
    //   maven 'Maven'
   //}
  stages {
       stage('Build') {
           steps {
              snDevOpsStep()
              sh 'mvn -B -DskipTests clean compile'
              snDevOpsArtifact(artifactsPayload: """{"artifacts": [{"name": "${artifactname}", "version": "1.${env.BUILD_NUMBER}","semanticVersion": "1.${env.BUILD_NUMBER}.0","repositoryName": "${repoName}"}],"branchName":"master"}""")
           }
       }
       stage('Test') {
           steps {
              snDevOpsStep()
               sh 'mvn test'
           }
           post {
                    always {
                junit "**/target/surefire-reports/*.xml"
             }
           }
       }
      stage('PublishPackage') {
                 steps {
                    snDevOpsStep()
                    echo 'Deploying....'
                    snDevOpsPackage(name: "${pkgName}-${env.BUILD_NUMBER}", artifactsPayload: """{"artifacts":[{"name": "${artifactname}", "version": "1.${env.BUILD_NUMBER}", "repositoryName": "${repoName}"}], "branchName":"master"}""")
                 }
      }

     stage('Change-Registration') {
         steps {
            snDevOpsStep()
            snDevOpsChange()
            echo 'Publishing Package....'
            // format-1
            // snDevOpsPackage(name: "newPackage", artifactsPayload: """{"artifacts": [{"name": "first_repo.jar","repositoryName": "first_repo","version": "${version}"},{"name": "sa-frontend.jar","repositoryName": "services-1031","version": "9.2"}],"branchName":"master"}""")
            //format-2
            //snDevOpsPackage(name: "newPackage", artifactsPayload: """{"artifacts": [{"name": "sa-web.jar","repositoryName": "services-1031","currentBuildInfo" : "true"},{"name": "sa-frontend.jar","repositoryName": "services-1031","currentBuildInfo" : "true"}],"branchName":"master"}""")
         
         	// format -3
         	//snDevOpsPackage(name: "balu-package", artifactsPayload: """{"artifacts": [{"name": "First_repo.jar","repositoryName": "First_repo","version":${version}}],"pipelineName": "balu_pipeline","taskExecutionNumber":"30","stageName":"PublishPackage","branchName": "master"}""")

         	
         }
     }
     
     stage('Change-Acceleration') {
           steps {
              snDevOpsChange()
           }
       }
 }
}
